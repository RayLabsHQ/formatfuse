---
import Layout from '../../layouts/Layout.astro';
import Navigation from '../../components/Navigation.tsx';
import ImageConverter from '../../components/converters/ImageConverter.tsx';
import '../../styles/global.css';

// Pre-render all dynamic routes at build time for SEO
export const prerender = true;

export async function getStaticPaths() {
  // All supported image formats
  // Note: HEIC is supported via libheif-js, others via image-rs
  const formats = [
    { key: 'png', name: 'PNG' },
    { key: 'jpg', name: 'JPG' },
    { key: 'webp', name: 'WebP' },
    { key: 'gif', name: 'GIF' },
    { key: 'bmp', name: 'BMP' },
    { key: 'ico', name: 'ICO' },
    { key: 'tiff', name: 'TIFF' },
    { key: 'avif', name: 'AVIF' },
    { key: 'heic', name: 'HEIC' }
  ];

  // Formats that support quality adjustment (useful for same-format conversion)
  const qualityFormats = ['jpg', 'webp', 'avif'];

  // Generate all possible combinations
  const paths = [];
  
  for (const from of formats) {
    for (const to of formats) {
      // Skip same format conversions EXCEPT for quality-adjustable formats
      if (from.key === to.key && !qualityFormats.includes(from.key)) continue;
      
      paths.push({
        params: { from: from.key, to: to.key }
      });
    }
  }
  
  return paths;
}

// Dynamic route parameters
const fromKey = Astro.params.from;
const toKey = Astro.params.to;
// Human-friendly format names
const formatNameMap = {
  png: 'PNG', jpg: 'JPEG/JPG', webp: 'WebP', gif: 'GIF',
  bmp: 'BMP', ico: 'ICO', tiff: 'TIFF', avif: 'AVIF', heic: 'HEIC'
};
const fromFormat = formatNameMap[fromKey] || fromKey.toUpperCase();
const toFormat = formatNameMap[toKey] || toKey.toUpperCase();
// Title and description logic
const isSame = fromKey === toKey;
const title = isSame
  ? `${fromFormat} Compressor - Optimize & Resize ${fromFormat} Images`
  : `${fromFormat} to ${toFormat} Converter - Free Online Tool`;
const description = isSame
  ? `Compress and optimize ${fromFormat} images by adjusting quality. Reduce file size while maintaining visual quality. No upload required, 100% private.`
  : `Convert ${fromFormat} images to ${toFormat} format instantly in your browser. No upload required, 100% private and secure. Supports batch conversion.`;

// Schema.org structured data for SEO
const structuredData = {
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": title,
  "description": description,
  "url": `https://formatfuse.com/convert/${fromKey}-to-${toKey}`,
  "applicationCategory": "UtilitiesApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "featureList": [
    "Browser-based conversion",
    "No file uploads",
    "Batch processing",
    "Privacy-focused",
    "No watermarks",
    "Unlimited conversions"
  ]
};
---

<Layout title={title} description={description}>
  <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
  
  <Navigation client:load />
  
  <main>
    <ImageConverter sourceFormat={fromKey} targetFormat={toKey} client:load />
  </main>
</Layout>